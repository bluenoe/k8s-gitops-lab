{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:base"
  ],
  "schedule": [
    "before 6am on monday"
  ],
  "timezone": "UTC",
  "labels": ["dependencies", "gitops"],
  "assignees": ["@devops-team"],
  "reviewers": ["@devops-team"],
  "prConcurrentLimit": 2,
  "prHourlyLimit": 1,
  "packageRules": [
    {
      "matchDatasources": ["docker"],
      "matchPackageNames": ["argoproj/argocd"],
      "rangeStrategy": "pin",
      "semanticCommitType": "chore",
      "semanticCommitScope": "argocd",
      "groupName": "ArgoCD"
    },
    {
      "matchDatasources": ["helm"],
      "rangeStrategy": "bump",
      "semanticCommitType": "chore",
      "semanticCommitScope": "helm",
      "reviewersFromCodeOwners": true
    },
    {
      "matchDatasources": ["docker"],
      "matchPackageNames": ["bitnami-labs/sealed-secrets"],
      "rangeStrategy": "pin",
      "semanticCommitType": "chore",
      "semanticCommitScope": "sealed-secrets"
    },
    {
      "matchFiles": ["applications/*.yaml"],
      "matchCurrentVersion": "/^v?(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)$/",
      "rangeStrategy": "pin",
      "semanticCommitType": "feat",
      "semanticCommitScope": "app",
      "automerge": false,
      "labels": ["application-update", "needs-manual-review"]
    }
  ],
  "regexManagers": [
    {
      "fileMatch": ["applications/.*\\.ya?ml$"],
      "matchStrings": [
        "targetRevision:\\s*[\"']?(?<currentValue>v?[0-9]+\\.[0-9]+\\.[0-9]+)[\"']?\\s*(?:#\\s*renovate:\\s*datasource=(?<datasource>[a-z-]+)\\s+depName=(?<depName>[^\\s]+)\\s*)?",
        "image:\\s*[\"']?(?<depName>[^:]+):(?<currentValue>v?[0-9]+\\.[0-9]+\\.[0-9]+)[\"']?\\s*(?:#\\s*renovate:\\s*datasource=(?<datasource>[a-z-]+)\\s*)?"
      ],
      "datasourceTemplate": "{{#if datasource}}{{{datasource}}}{{else}}github-releases{{/if}}",
      "depNameTemplate": "{{#if depName}}{{{depName}}}{{else}}argoproj/argo-cd{{/if}}"
    },
    {
      "fileMatch": ["bootstrap/.*\\.(sh|bat)$"],
      "matchStrings": [
        "ARGOCD_VERSION=[\"']?(?<currentValue>v?[0-9]+\\.[0-9]+\\.[0-9]+)[\"']?",
        "SEALED_SECRETS_VERSION=[\"']?(?<currentValue>v?[0-9]+\\.[0-9]+\\.[0-9]+)[\"']?"
      ],
      "datasourceTemplate": "github-releases",
      "depNameTemplate": "{{#if (containsString currentValue 'ARGOCD')}}argoproj/argo-cd{{else}}bitnami-labs/sealed-secrets{{/if}}"
    }
  ],
  "vulnerabilityAlerts": {
    "enabled": true,
    "labels": ["security", "vulnerability"]
  },
  "dependencyDashboard": true,
  "dependencyDashboardTitle": "GitOps Dependency Dashboard",
  "dependencyDashboardHeader": "This dashboard shows all dependencies that can be updated in the GitOps repository.",
  "ignorePaths": [
    "**/node_modules/**",
    "**/dist/**"
  ],
  "customManagers": [
    {
      "customType": "regex",
      "fileMatch": ["applications/.*\\.ya?ml$"],
      "matchStrings": [
        "chart:\\s*(?<depName>[^\\s]+)\\s+targetRevision:\\s*[\"']?(?<currentValue>[^\\s\"']+)[\"']?"
      ],
      "datasourceTemplate": "helm"
    }
  ]
}